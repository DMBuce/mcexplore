#!/bin/bash
# update version every commit

# update version
version="2.$(( $(git rev-list --count HEAD)+1 )).g$(git rev-parse --short HEAD)+1"
updatever() {
	echo "Updating version to $version"
	sed -i "/version =/ s/=.*/= f'{prog} $version'/" mcexplore.py
}

# check if mcexplore.py has no unstaged changes
if ! git status --porcelain | grep -q '^.M mcexplore.py'; then
	# update version and add mcexplore.py to commit
	updatever
	echo "Adding mcexplore.py to commit"
	git add mcexplore.py
# update the version and check if it changed
elif updatever; git diff mcexplore.py | grep -q -e '^[+-] *version ='; then
	# prompt user to add the updated version to the commit
	echo "Please add the version change with \`git add -p mcexplore.py\` before committing."
	exit 1
fi

